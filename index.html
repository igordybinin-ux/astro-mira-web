<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tarot Mira</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0; padding: 0;
            background: radial-gradient(circle at center, #1a0b2e 0%, #000000 100%);
            color: #e0e0e0; font-family: 'Montserrat', sans-serif;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –ú–ï–ù–Æ --- */
        #menu-screen {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; width: 100%; position: absolute; z-index: 10;
            background: #111; transition: opacity 0.5s;
        }
        
        .menu-title {
            font-family: 'Cinzel', serif; font-size: 24px; color: #ffd700;
            margin-bottom: 30px; text-transform: uppercase; letter-spacing: 2px; text-align: center;
        }

        .menu-btn {
            background: linear-gradient(45deg, #1c1c24, #2a2a35);
            border: 1px solid #c5a059; color: #fff;
            padding: 15px 25px; margin: 8px; border-radius: 8px;
            font-family: 'Cinzel', serif; font-size: 14px;
            width: 85%; max-width: 320px; cursor: pointer;
            transition: transform 0.2s, background 0.3s;
            position: relative; 
        }
        .menu-btn:active { transform: scale(0.95); background: #c5a059; color: #000; }
        .menu-btn span { display: block; font-size: 11px; font-family: 'Montserrat', sans-serif; color: #aaa; margin-top: 4px; text-transform: none; }

        /* –ë–≠–ô–î–ñ–ò */
        .badge {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            background: #ffd700; color: #000; padding: 3px 6px; border-radius: 4px;
            font-size: 9px; font-weight: bold; font-family: 'Montserrat', sans-serif;
        }
        .badge-free { background: #4CAF50; color: #fff; }
        .badge-sale { background: #ff4444; color: #fff; border: 1px solid #fff; }

        /* --- –ì–ê–õ–ï–†–ï–Ø (–°–¢–ò–õ–ò) --- */
        #gallery-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100; flex-direction: column; align-items: center;
        }
        .gallery-header {
            width: 100%; padding: 15px; display: flex; justify-content: space-between;
            align-items: center; background: #111; border-bottom: 1px solid #c5a059; box-sizing: border-box;
        }
        #gallery-tabs {
            width: 100%; display: flex; overflow-x: auto; background: #1a1a1a; padding: 10px 0;
            scrollbar-width: none;
        }
        #gallery-tabs::-webkit-scrollbar { display: none; }
        .tab-btn {
            background: none; border: none; color: #777; padding: 5px 15px; white-space: nowrap;
            font-family: 'Cinzel', serif; font-size: 12px; cursor: pointer; transition: 0.3s;
        }
        .tab-btn.active { color: #ffd700; border-bottom: 2px solid #ffd700; }

        #gallery-grid {
            flex: 1; width: 100%; overflow-y: auto; display: grid;
            grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px;
            align-content: start; box-sizing: border-box;
        }

        /* üî• –°–¢–ò–õ–¨ –ö–ê–†–¢–´ –í –ì–ê–õ–ï–†–ï–ï */
        .gallery-item { 
            width: 100%; aspect-ratio: 2/3; border-radius: 6px; overflow: hidden; 
            border: 1px solid #c5a059; background: #111; position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); transition: transform 0.2s;
        }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: filter 0.3s; }

        /* –≠–§–§–ï–ö–¢ –ó–ê–ö–†–´–¢–û–ô –ö–ê–†–¢–´ */
        .gallery-item.locked img { filter: grayscale(100%) brightness(25%); }
        .gallery-item.locked::after {
            content: "üîí"; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-size: 18px; opacity: 0.4;
        }

        /* –ú–û–î–ê–õ–ö–ê */
        #card-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 200; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px; box-sizing: border-box;
        }

        /* --- –ò–ì–†–û–í–û–ï –ü–û–õ–ï --- */
        #game-screen {
            display: none; flex-direction: column; align-items: center;
            width: 100%; height: 100%; padding-top: 5px;
        }

        h2 { 
            font-family: 'Cinzel', serif; margin-bottom: 5px; font-weight: 400; 
            color: #ffd700; text-transform: uppercase; letter-spacing: 2px; 
            text-align: center; font-size: 16px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); height: 25px;
        }

        .cards-container {
            display: flex; justify-content: center; align-items: center;
            width: 100%; height: 500px; transition: all 0.3s;
        }
        .cards-container.mode-five, .cards-container.mode-ten { flex-wrap: wrap; align-content: center; }
        .card-wrapper { display: flex; flex-direction: column; align-items: center; margin: 0 4px; perspective: 1000px; }
        .card {
            position: relative; transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }

        .mode-single .card { width: 240px; height: 360px; }
        .mode-triple .card { width: 100px; height: 155px; }
        .mode-five .card { width: 85px; height: 130px; }
        .mode-ten .card-wrapper { width: 31%; margin: 2px 1%; }
        .mode-ten .card { width: 100%; height: 110px; border-radius: 5px; }
        .mode-ten .card-label { font-size: 8px; margin-top: 2px; height: 10px; max-width: 100%; }

        @media (max-width: 340px) { 
            .mode-triple .card { width: 85px; height: 130px; } 
            .mode-five .card { width: 70px; height: 110px; }
            .mode-ten .card { height: 90px; }
        }

        .card.is-flipped { transform: rotateY(180deg); }
        .card__face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            border-radius: 8px; overflow: hidden; border: 2px solid #c5a059;
            box-sizing: border-box; background: #000;
        }
        .mode-ten .card__face { border-radius: 5px; border-width: 1px; }
        .card__face--front { transform: rotateY(0deg); }
        .card__face--back { transform: rotateY(180deg); }
        .card-img-content { width: 100%; height: 100%; object-fit: cover; }

        .card-label {
            margin-top: 8px; text-align: center; font-size: 10px; color: #aaa;
            text-transform: uppercase; font-family: 'Montserrat', sans-serif;
            letter-spacing: 1px; height: 12px;
        }
        .info-block { margin-top: 5px; text-align: center; opacity: 0; transition: opacity 0.5s; height: 40px; }
        .info-block.visible { opacity: 1; }
        .card-name-text { font-family: 'Cinzel', serif; color: #ffd700; font-size: 16px; margin-bottom: 2px; }
        .card-desc-text { font-size: 11px; color: #ccc; max-width: 300px; margin: 0 auto; line-height: 1.2; }

        .action-btn {
            margin-top: auto; margin-bottom: 20px; padding: 12px 40px;
            background: linear-gradient(45deg, #c5a059, #ffd700); color: #000;
            border: none; border-radius: 4px; font-family: 'Cinzel', serif;
            font-weight: 700; font-size: 13px; opacity: 0; pointer-events: none;
            transition: opacity 0.5s; text-transform: uppercase;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); cursor: pointer;
        }
        .action-btn.visible { opacity: 1; pointer-events: all; }
    </style>
</head>
<body>

    <div id="menu-screen">
        <div class="menu-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–∫–ª–∞–¥</div>
        
        <button class="menu-btn" onclick="startGame('single')">
            –ö–∞—Ä—Ç–∞ –î–Ω—è
            <span>–û–¥–∏–Ω —Å–æ–≤–µ—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</span>
            <div class="badge badge-free">FREE</div>
        </button>
        
        <button class="menu-btn" onclick="startGame('triple')">
            –¢—Ä–∏ –°—É–¥—å–±—ã
            <span>–ü—Ä–æ—à–ª–æ–µ / –ù–∞—Å—Ç–æ—è—â–µ–µ / –ë—É–¥—É—â–µ–µ</span>
            <div class="badge">PRO</div>
        </button>
        
        <button class="menu-btn" onclick="startGame('five')">
            –ü–æ–¥–∫–æ–≤–∞ (5 –∫–∞—Ä—Ç)
            <span>–°–∫—Ä—ã—Ç–æ–µ –∏ –ò—Ç–æ–≥–∏</span>
            <div class="badge">PRO</div>
        </button>
        
        <button class="menu-btn" onclick="startGame('ten')" style="border-color: #ff4444; box-shadow: 0 0 10px rgba(255,68,68,0.2);">
            –ö–µ–ª—å—Ç—Å–∫–∏–π –ö—Ä–µ—Å—Ç
            <span>–ü–æ–ª–Ω—ã–π —Ä–∞—Å–∫–ª–∞–¥ (10 –∫–∞—Ä—Ç)</span>
            <div class="badge badge-sale">290‚ÇΩ | 99‚ÇΩ PRO</div>
        </button>

        <button class="menu-btn" onclick="openGallery()" style="margin-top: 20px; background: #222; border-color: #777;">
            –ö–æ–ª–ª–µ–∫—Ü–∏—è –ö–∞—Ä—Ç
            <span>–í–∞—à–∞ —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è –¢–∞—Ä–æ</span>
        </button>
    </div>

    <div id="gallery-screen">
        <div class="gallery-header">
            <span style="font-family:'Cinzel', serif; color:#ffd700;">–ö–æ–ª–ª–µ–∫—Ü–∏—è</span>
            <button onclick="closeGallery()" style="background:none; border:none; color:#ffd700; font-size:24px; cursor:pointer;">‚úï</button>
        </div>
        <div id="gallery-tabs">
            <button class="tab-btn active" onclick="filterGallery('major', event)">–°—Ç–∞—Ä—à–∏–µ</button>
            <button class="tab-btn" onclick="filterGallery('wands', event)">–ñ–µ–∑–ª—ã</button>
            <button class="tab-btn" onclick="filterGallery('cups', event)">–ö—É–±–∫–∏</button>
            <button class="tab-btn" onclick="filterGallery('swords', event)">–ú–µ—á–∏</button>
            <button class="tab-btn" onclick="filterGallery('pentacles', event)">–ú–æ–Ω–µ—Ç—ã</button>
        </div>
        <div id="gallery-grid"></div>
    </div>

    <div id="card-modal" onclick="this.style.display='none'">
        <img id="modal-img" src="" style="width:80%; max-width:280px; border-radius:10px; border:2px solid #ffd700; margin-bottom:20px;">
        <h3 id="modal-title" style="color:#ffd700; font-family:'Cinzel', serif; margin:0; text-transform:uppercase;"></h3>
        <p id="modal-desc" style="text-align:center; color:#ccc; font-size:14px; max-width:300px; line-height:1.4; margin-top:10px;"></p>
        <span style="color:#777; font-size:10px; margin-top:20px;">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å</span>
    </div>

    <div id="game-screen">
        <h2 id="status-text">–ö–æ—Å–Ω–∏—Ç–µ—Å—å –∫–∞—Ä—Ç—ã</h2>
        <div class="cards-container" id="cards-container"></div>
        <div class="info-block" id="info-block">
            <div class="card-name-text" id="info-name"></div>
            <div class="card-desc-text" id="info-desc"></div>
        </div>
        <button class="action-btn" id="sendBtn" onclick="sendResult()">–ü—Ä–∏–Ω—è—Ç—å –°—É–¥—å–±—É</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); 

        const tarotDeck = [
            {name: "–®—É—Ç", id: "fool", type: "major", desc: "–ù–∞—á–∞–ª–æ –ø—É—Ç–∏, —Å–≤–æ–±–æ–¥–∞, —Ä–∏—Å–∫ –∏ –≤–µ—Ä–∞ –≤ —á—É–¥–æ."},
            {name: "–ú–∞–≥", id: "magician", type: "major", desc: "–í–æ–ª—è, –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é."},
            {name: "–ñ—Ä–∏—Ü–∞", id: "priestess", type: "major", desc: "–ò–Ω—Ç—É–∏—Ü–∏—è, —Ç–∞–π–Ω—ã, –≥–ª—É–±–æ–∫–æ–µ –ø–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞–Ω–∏–µ."},
            {name: "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", id: "empress", type: "major", desc: "–ü–ª–æ–¥–æ—Ä–æ–¥–∏–µ, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –∏–∑–æ–±–∏–ª–∏–µ –∏ –ø—Ä–∏—Ä–æ–¥–∞."},
            {name: "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä", id: "emperor", type: "major", desc: "–í–ª–∞—Å—Ç—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å."},
            {name: "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç", id: "hierophant", type: "major", desc: "–¢—Ä–∞–¥–∏—Ü–∏—è, –≤–µ—Ä–∞, –æ–±—É—á–µ–Ω–∏–µ –∏ –¥—É—Ö–æ–≤–Ω—ã–π –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç."},
            {name: "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ", id: "lovers", type: "major", desc: "–í—ã–±–æ—Ä —Å–µ—Ä–¥—Ü–∞, —Å–æ—é–∑, –≥–∞—Ä–º–æ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π."},
            {name: "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞", id: "chariot", type: "major", desc: "–ü–æ–±–µ–¥–∞ —á–µ—Ä–µ–∑ –≤–æ–ª—é, –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è–º–∏."},
            {name: "–°–∏–ª–∞", id: "strength", type: "major", desc: "–ú—è–≥–∫–∞—è —Å–∏–ª–∞, —Ç–µ—Ä–ø–µ–Ω–∏–µ, –ø–æ–∫–æ—Ä–µ–Ω–∏–µ —Å—Ç—Ä–∞—Å—Ç–µ–π."},
            {name: "–û—Ç—à–µ–ª—å–Ω–∏–∫", id: "hermit", type: "major", desc: "–ú—É–¥—Ä–æ—Å—Ç—å, —É–µ–¥–∏–Ω–µ–Ω–∏–µ, –ø–æ–∏—Å–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–≤–µ—Ç–∞."},
            {name: "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", id: "fortune", type: "major", desc: "–°—É–¥—å–±–∞, —É–¥–∞—á–∞, —Ü–∏–∫–ª—ã –ø–µ—Ä–µ–º–µ–Ω."},
            {name: "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", id: "justice", type: "major", desc: "–ü—Ä–∞–≤–¥–∞, –∑–∞–∫–æ–Ω, –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –∫–∞—Ä–º–∞."},
            {name: "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", id: "hanged", type: "major", desc: "–ñ–µ—Ä—Ç–≤–∞ —Ä–∞–¥–∏ –∑–Ω–∞–Ω–∏—è, –ø–∞—É–∑–∞, –Ω–æ–≤—ã–π –≤–∑–≥–ª—è–¥."},
            {name: "–°–º–µ—Ä—Ç—å", id: "death", type: "major", desc: "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–æ–Ω–µ—Ü —Å—Ç–∞—Ä–æ–≥–æ, –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ."},
            {name: "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", id: "temperance", type: "major", desc: "–ë–∞–ª–∞–Ω—Å, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ, –∑–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞."},
            {name: "–î—å—è–≤–æ–ª", id: "devil", type: "major", desc: "–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, —Ç–µ–Ω–µ–≤—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã, –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π –ø–ª–µ–Ω."},
            {name: "–ë–∞—à–Ω—è", id: "tower", type: "major", desc: "–í–Ω–µ–∑–∞–ø–Ω—ã–π –∫—Ä–∞—Ö –∏–ª–ª—é–∑–∏–π, –æ—á–∏—â–∞—é—â–∏–π —Ö–∞–æ—Å."},
            {name: "–ó–≤–µ–∑–¥–∞", id: "star", type: "major", desc: "–ù–∞–¥–µ–∂–¥–∞, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –¥—É—Ö–æ–≤–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ."},
            {name: "–õ—É–Ω–∞", id: "moon", type: "major", desc: "–ò–ª–ª—é–∑–∏–∏, —Å—Ç—Ä–∞—Ö–∏, –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–µ —Å–Ω—ã."},
            {name: "–°–æ–ª–Ω—Ü–µ", id: "sun", type: "major", desc: "–£—Å–ø–µ—Ö, —Ä–∞–¥–æ—Å—Ç—å, —è—Å–Ω–æ—Å—Ç—å –∏ –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏–ª–∞."},
            {name: "–°—É–¥", id: "judgement", type: "major", desc: "–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ, –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é, –ø—Ä–æ—â–µ–Ω–∏–µ."},
            {name: "–ú–∏—Ä", id: "world", type: "major", desc: "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–∞, –≥–∞—Ä–º–æ–Ω–∏—è, —Ç—Ä–∏—É–º—Ñ."},
            {name: "–¢—É–∑ –ñ–µ–∑–ª–æ–≤", id: "wands_ace", type: "wands", desc: "–ò–º–ø—É–ª—å—Å, —Ç–≤–æ—Ä—á–µ—Å–∫–∞—è –∏—Å–∫—Ä–∞, –Ω–æ–≤–∞—è –∏–¥–µ—è."},
            {name: "2 –ñ–µ–∑–ª–æ–≤", id: "wands_2", type: "wands", desc: "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤—ã–±–æ—Ä –ø—É—Ç–∏."},
            {name: "3 –ñ–µ–∑–ª–æ–≤", id: "wands_3", type: "wands", desc: "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã, –æ–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."},
            {name: "4 –ñ–µ–∑–ª–æ–≤", id: "wands_4", type: "wands", desc: "–ü—Ä–∞–∑–¥–Ω–∏–∫, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —É—Å–ø–µ—Ö."},
            {name: "5 –ñ–µ–∑–ª–æ–≤", id: "wands_5", type: "wands", desc: "–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è, –±–æ—Ä—å–±–∞ –∞–º–±–∏—Ü–∏–π."},
            {name: "6 –ñ–µ–∑–ª–æ–≤", id: "wands_6", type: "wands", desc: "–ü–æ–±–µ–¥–∞, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ."},
            {name: "7 –ñ–µ–∑–ª–æ–≤", id: "wands_7", type: "wands", desc: "–ó–∞—â–∏—Ç–∞ —Å–≤–æ–∏—Ö –ø–æ–∑–∏—Ü–∏–π."},
            {name: "8 –ñ–µ–∑–ª–æ–≤", id: "wands_8", type: "wands", desc: "–°–∫–æ—Ä–æ—Å—Ç—å, –ø–æ–ª–µ—Ç —Å—Ç—Ä–µ–ª, –±—ã—Å—Ç—Ä—ã–µ –Ω–æ–≤–æ—Å—Ç–∏."},
            {name: "9 –ñ–µ–∑–ª–æ–≤", id: "wands_9", type: "wands", desc: "–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä—É–±–µ–∂, —Å—Ç–æ–π–∫–æ—Å—Ç—å."},
            {name: "10 –ñ–µ–∑–ª–æ–≤", id: "wands_10", type: "wands", desc: "–¢—è–∂–µ–ª–æ–µ –±—Ä–µ–º—è, –ø—Ä–µ–¥–µ–ª —Å–∏–ª."},
            {name: "–ü–∞–∂ –ñ–µ–∑–ª–æ–≤", id: "wands_page", type: "wands", desc: "–Æ–Ω–æ—à–µ—Å–∫–∏–π –ø—ã–ª, —ç–Ω—Ç—É–∑–∏–∞–∑–º."},
            {name: "–†—ã—Ü–∞—Ä—å –ñ–µ–∑–ª–æ–≤", id: "wands_knight", type: "wands", desc: "–ù–∞–ø–æ—Ä, —Å—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ."},
            {name: "–ö–æ—Ä–æ–ª–µ–≤–∞ –ñ–µ–∑–ª–æ–≤", id: "wands_queen", type: "wands", desc: "–•–∞—Ä–∏–∑–º–∞, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å."},
            {name: "–ö–æ—Ä–æ–ª—å –ñ–µ–∑–ª–æ–≤", id: "wands_king", type: "wands", desc: "–õ–∏–¥–µ—Ä—Å—Ç–≤–æ, —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å."},
            {name: "–¢—É–∑ –ö—É–±–∫–æ–≤", id: "cups_ace", type: "cups", desc: "–ò—Å—Ç–æ—á–Ω–∏–∫ —á—É–≤—Å—Ç–≤, –ª—é–±–æ–≤—å."},
            {name: "2 –ö—É–±–∫–æ–≤", id: "cups_2", type: "cups", desc: "–í—Å—Ç—Ä–µ—á–∞, —Å–æ—é–∑, –≤–∑–∞–∏–º–Ω–∞—è —Å–∏–º–ø–∞—Ç–∏—è."},
            {name: "3 –ö—É–±–∫–æ–≤", id: "cups_3", type: "cups", desc: "–î—Ä—É–∂–±–∞, –ø—Ä–∞–∑–¥–Ω–∏–∫."},
            {name: "4 –ö—É–±–∫–æ–≤", id: "cups_4", type: "cups", desc: "–ü—Ä–µ—Å—ã—â–µ–Ω–∏–µ, –∞–ø–∞—Ç–∏—è."},
            {name: "5 –ö—É–±–∫–æ–≤", id: "cups_5", type: "cups", desc: "–ü–µ—á–∞–ª—å –æ –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–º."},
            {name: "6 –ö—É–±–∫–æ–≤", id: "cups_6", type: "cups", desc: "–ù–æ—Å—Ç–∞–ª—å–≥–∏—è, –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è."},
            {name: "7 –ö—É–±–∫–æ–≤", id: "cups_7", type: "cups", desc: "–ò–ª–ª—é–∑–∏–∏, –≤—ã–±–æ—Ä –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤."},
            {name: "8 –ö—É–±–∫–æ–≤", id: "cups_8", type: "cups", desc: "–£—Ö–æ–¥ –≤ –ø–æ–∏—Å–∫–∞—Ö –≤—ã—Å—à–µ–≥–æ."},
            {name: "9 –ö—É–±–∫–æ–≤", id: "cups_9", type: "cups", desc: "–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∂–µ–ª–∞–Ω–∏–π, –¥–æ–≤–æ–ª—å—Å—Ç–≤–æ."},
            {name: "10 –ö—É–±–∫–æ–≤", id: "cups_10", type: "cups", desc: "–°–µ–º–µ–π–Ω–æ–µ —Å—á–∞—Å—Ç—å–µ."},
            {name: "–ü–∞–∂ –ö—É–±–∫–æ–≤", id: "cups_page", type: "cups", desc: "–ù–µ–∂–Ω—ã–µ —á—É–≤—Å—Ç–≤–∞, –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ."},
            {name: "–†—ã—Ü–∞—Ä—å –ö—É–±–∫–æ–≤", id: "cups_knight", type: "cups", desc: "–†–æ–º–∞–Ω—Ç–∏–∫–∞, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ."},
            {name: "–ö–æ—Ä–æ–ª–µ–≤–∞ –ö—É–±–∫–æ–≤", id: "cups_queen", type: "cups", desc: "–ò–Ω—Ç—É–∏—Ü–∏—è, —ç–º–ø–∞—Ç–∏—è."},
            {name: "–ö–æ—Ä–æ–ª—å –ö—É–±–∫–æ–≤", id: "cups_king", type: "cups", desc: "–ó—Ä–µ–ª–æ—Å—Ç—å —á—É–≤—Å—Ç–≤, –º—É–¥—Ä–æ—Å—Ç—å."},
            {name: "–¢—É–∑ –ú–µ—á–µ–π", id: "swords_ace", type: "swords", desc: "–Ø—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –æ—Ç—Å–µ—á–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ."},
            {name: "2 –ú–µ—á–µ–π", id: "swords_2", type: "swords", desc: "–¢—É–ø–∏–∫, –∑–∞–∫—Ä—ã—Ç–æ—Å—Ç—å."},
            {name: "3 –ú–µ—á–µ–π", id: "swords_3", type: "swords", desc: "–†–∞–∑–±–∏—Ç–æ–µ —Å–µ—Ä–¥—Ü–µ, –≥–æ—Ä—å–∫–∞—è –ø—Ä–∞–≤–¥–∞."},
            {name: "4 –ú–µ—á–µ–π", id: "swords_4", type: "swords", desc: "–û—Ç–¥—ã—Ö, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–ª."},
            {name: "5 –ú–µ—á–µ–π", id: "swords_5", type: "swords", desc: "–ñ–µ—Å—Ç–æ–∫–∞—è –ø–æ–±–µ–¥–∞, –∫–æ–Ω—Ñ–ª–∏–∫—Ç."},
            {name: "6 –ú–µ—á–µ–π", id: "swords_6", type: "swords", desc: "–£—Ö–æ–¥ –æ—Ç –ø—Ä–æ–±–ª–µ–º."},
            {name: "7 –ú–µ—á–µ–π", id: "swords_7", type: "swords", desc: "–•–∏—Ç—Ä–æ—Å—Ç—å, —Ç–∞–∫—Ç–∏–∫–∞."},
            {name: "8 –ú–µ—á–µ–π", id: "swords_8", type: "swords", desc: "–ü–ª–µ–Ω –º—ã—Å–ª–µ–π, —Å–∞–º–æ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è."},
            {name: "9 –ú–µ—á–µ–π", id: "swords_9", type: "swords", desc: "–¢—Ä–µ–≤–æ–≥–∞, –±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞."},
            {name: "10 –ú–µ—á–µ–π", id: "swords_10", type: "swords", desc: "–ü–æ–ª–Ω—ã–π –∫—Ä–∞—Ö, –∫–æ–Ω–µ—Ü –º—É—á–µ–Ω–∏–π."},
            {name: "–ü–∞–∂ –ú–µ—á–µ–π", id: "swords_page", type: "swords", desc: "–û—Å—Ç—Ä—ã–π —É–º, –∫—Ä–∏—Ç–∏–∫–∞."},
            {name: "–†—ã—Ü–∞—Ä—å –ú–µ—á–µ–π", id: "swords_knight", type: "swords", desc: "–ù–∞–ø–æ—Ä, –ø–æ—Ä—ã–≤."},
            {name: "–ö–æ—Ä–æ–ª–µ–≤–∞ –ú–µ—á–µ–π", id: "swords_queen", type: "swords", desc: "–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –ª–æ–≥–∏–∫–∞."},
            {name: "–ö–æ—Ä–æ–ª—å –ú–µ—á–µ–π", id: "swords_king", type: "swords", desc: "–ó–∞–∫–æ–Ω, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è."},
            {name: "–¢—É–∑ –ú–æ–Ω–µ—Ç", id: "pentacles_ace", type: "pentacles", desc: "–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π –¥–∞—Ä, —à–∞–Ω—Å –Ω–∞ –ø—Ä–∏–±—ã–ª—å."},
            {name: "2 –ú–æ–Ω–µ—Ç", id: "pentacles_2", type: "pentacles", desc: "–°—É–µ—Ç–∞, –≥–∏–±–∫–æ—Å—Ç—å."},
            {name: "3 –ú–æ–Ω–µ—Ç", id: "pentacles_3", type: "pentacles", desc: "–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, –∫–æ–º–∞–Ω–¥–∞."},
            {name: "4 –ú–æ–Ω–µ—Ç", id: "pentacles_4", type: "pentacles", desc: "–°–∫—É–ø–æ—Å—Ç—å, —Å—Ç—Ä–∞—Ö –ø–æ—Ç–µ—Ä—å."},
            {name: "5 –ú–æ–Ω–µ—Ç", id: "pentacles_5", type: "pentacles", desc: "–ö—Ä–∏–∑–∏—Å, –Ω–µ—Ö–≤–∞—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤."},
            {name: "6 –ú–æ–Ω–µ—Ç", id: "pentacles_6", type: "pentacles", desc: "–ü–æ–º–æ—â—å, –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å."},
            {name: "7 –ú–æ–Ω–µ—Ç", id: "pentacles_7", type: "pentacles", desc: "–¢–µ—Ä–ø–µ–Ω–∏–µ, –æ–∂–∏–¥–∞–Ω–∏–µ —É—Ä–æ–∂–∞—è."},
            {name: "8 –ú–æ–Ω–µ—Ç", id: "pentacles_8", type: "pentacles", desc: "–¢—Ä—É–¥–æ–ª—é–±–∏–µ, —Ä–µ–º–µ—Å–ª–æ."},
            {name: "9 –ú–æ–Ω–µ—Ç", id: "pentacles_9", type: "pentacles", desc: "–†–æ—Å–∫–æ—à—å, —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å."},
            {name: "10 –ú–æ–Ω–µ—Ç", id: "pentacles_10", type: "pentacles", desc: "–ù–∞—Å–ª–µ–¥–∏–µ, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å."},
            {name: "–ü–∞–∂ –ú–æ–Ω–µ—Ç", id: "pentacles_page", type: "pentacles", desc: "–£—á–µ–Ω–∏—á–µ—Å—Ç–≤–æ, –Ω–æ–≤–æ—Å—Ç–∏."},
            {name: "–†—ã—Ü–∞—Ä—å –ú–æ–Ω–µ—Ç", id: "pentacles_knight", type: "pentacles", desc: "–£–ø–æ—Ä—Å—Ç–≤–æ, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å."},
            {name: "–ö–æ—Ä–æ–ª–µ–≤–∞ –ú–æ–Ω–µ—Ç", id: "pentacles_queen", type: "pentacles", desc: "–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å, –∏–∑–æ–±–∏–ª–∏–µ."},
            {name: "–ö–æ—Ä–æ–ª—å –ú–æ–Ω–µ—Ç", id: "pentacles_king", type: "pentacles", desc: "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É—Å–ø–µ—Ö."}
        ];

        // üî• –õ–û–ì–ò–ö–ê –ö–û–õ–õ–ï–ö–¶–ò–ò (LOCAL STORAGE)
        function unlockCard(cardId) {
            let collection = JSON.parse(localStorage.getItem('mira_collection') || '[]');
            if (!collection.includes(cardId)) {
                collection.push(cardId);
                localStorage.setItem('mira_collection', JSON.stringify(collection));
            }
        }

        function isCardUnlocked(cardId) {
            let collection = JSON.parse(localStorage.getItem('mira_collection') || '[]');
            return collection.includes(cardId);
        }

        // –ì–ê–õ–ï–†–ï–Ø
        function openGallery() {
            document.getElementById('gallery-screen').style.display = 'flex';
            filterGallery('major'); 
        }

        function closeGallery() {
            document.getElementById('gallery-screen').style.display = 'none';
        }

        function filterGallery(type, event) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            if (event) { event.target.classList.add('active'); } 
            else { document.querySelector(`.tab-btn[onclick*="${type}"]`).classList.add('active'); }

            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = '';

            const filtered = tarotDeck.filter(c => c.type === type);
            filtered.forEach(card => {
                const unlocked = isCardUnlocked(card.id);
                const item = document.createElement('div');
                item.className = 'gallery-item' + (unlocked ? '' : ' locked');
                item.onclick = () => showCardDetail(card, unlocked);
                item.innerHTML = `<img src="cards/${card.id}.jpg">`;
                grid.appendChild(item);
            });
        }

        function showCardDetail(card, unlocked) {
            const modalImg = document.getElementById('modal-img');
            modalImg.src = `cards/${card.id}.jpg`;
            modalImg.style.filter = unlocked ? 'none' : 'grayscale(100%) brightness(25%)';
            
            document.getElementById('modal-title').innerText = unlocked ? card.name : "–ö–∞—Ä—Ç–∞ —Å–∫—Ä—ã—Ç–∞";
            document.getElementById('modal-desc').innerText = unlocked ? card.desc : "–≠—Ç–∞ —ç–Ω–µ—Ä–≥–∏—è –µ—â–µ –Ω–µ –ø—Ä–æ—è–≤–ª–µ–Ω–∞ –≤ —Ç–≤–æ–µ–π —Å—É–¥—å–±–µ. –î–µ–ª–∞–π —Ä–∞—Å–∫–ª–∞–¥—ã, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –µ—ë.";
            document.getElementById('card-modal').style.display = 'flex';
        }

        // –õ–û–ì–ò–ö–ê –ò–ì–†–´
        function startGame(mode) {
            currentMode = mode;
            document.getElementById('menu-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('menu-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'flex';
                initBoard();
            }, 500);
        }

        function initBoard() {
            const container = document.getElementById('cards-container');
            container.innerHTML = '';
            flippedCount = 0;
            selectedCards = [];
            const shuffled = [...tarotDeck].sort(() => 0.5 - Math.random());
            
            container.className = 'cards-container';
            container.classList.add(`mode-${currentMode}`);

            let count = (currentMode === 'single' ? 1 : (currentMode === 'triple' ? 3 : (currentMode === 'five' ? 5 : 10)));
            let labels = [];

            if (currentMode === 'triple') labels = ["–ü—Ä–æ—à–ª–æ–µ", "–ù–∞—Å—Ç–æ—è—â–µ–µ", "–ë—É–¥—É—â–µ–µ"];
            else if (currentMode === 'five') labels = ["–ü—Ä–æ—à–ª–æ–µ", "–ù–∞—Å—Ç–æ—è—â–µ–µ", "–ë—É–¥—É—â–µ–µ", "–°–∫—Ä—ã—Ç–æ–µ", "–ò—Ç–æ–≥"];
            else if (currentMode === 'ten') labels = ["–¢–µ–∫—É—â–µ–µ", "–ü—Ä–æ–±–ª–µ–º–∞", "–ü—Ä–æ—à–ª–æ–µ", "–ë—É–¥—É—â–µ–µ", "–°–æ–∑–Ω–∞–Ω–∏–µ", "–ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ", "–°–æ–≤–µ—Ç", "–í–Ω–µ—à–Ω–µ–µ", "–°—Ç—Ä–∞—Ö–∏", "–ò—Ç–æ–≥"];

            for (let i = 0; i < count; i++) {
                const cardData = shuffled[i];
                selectedCards.push(cardData);
                const wrapper = document.createElement('div');
                wrapper.className = 'card-wrapper';
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.onclick = () => flipCardLogic(cardEl, cardData, i);
                cardEl.innerHTML = `
                    <div class="card__face card__face--front"><img src="cards/back.jpg" class="card-img-content"></div>
                    <div class="card__face card__face--back"><img src="cards/${cardData.id}.jpg" class="card-img-content"></div>
                `;
                wrapper.appendChild(cardEl);
                if (currentMode !== 'single') {
                    const labelEl = document.createElement('div');
                    labelEl.className = 'card-label';
                    labelEl.innerText = labels[i];
                    wrapper.appendChild(labelEl);
                }
                container.appendChild(wrapper);
            }
        }

        function flipCardLogic(element, data, index) {
            if (element.classList.contains('is-flipped')) return;
            element.classList.add('is-flipped');
            flippedCount++;
            
            // üî• –û–¢–ö–†–´–í–ê–ï–ú –ö–ê–†–¢–£ –î–õ–Ø –ö–û–õ–õ–ï–ö–¶–ò–ò
            unlockCard(data.id);

            if (currentMode === 'single') {
                document.getElementById('status-text').innerText = "–°—É–¥—å–±–∞ –æ—Ç–∫—Ä—ã—Ç–∞";
                document.getElementById('info-name').innerText = data.name;
                document.getElementById('info-desc').innerText = data.desc;
                document.getElementById('info-block').classList.add('visible');
            } else {
                const total = selectedCards.length;
                document.getElementById('status-text').innerText = `–û—Ç–∫—Ä—ã—Ç–æ ${flippedCount} –∏–∑ ${total}`;
                if (flippedCount === total) document.getElementById('status-text').innerText = "–ö–∞—Ä—Ç–∏–Ω–∞ —è—Å–Ω–∞";
            }
            if (flippedCount === selectedCards.length) {
                setTimeout(() => { document.getElementById('sendBtn').classList.add('visible'); }, 600);
            }
        }

        function sendResult() {
            const btn = document.getElementById('sendBtn');
            btn.innerText = "–û—Ç–ø—Ä–∞–≤–∫–∞...";
            btn.style.opacity = "0.7";
            let dataToSend = {};
            try {
                if (currentMode === 'single') {
                    dataToSend = { type: "tarot_result", card_name: selectedCards[0].name, card_id: selectedCards[0].id };
                } else {
                    let type = "tarot_spread_" + (currentMode === 'triple' ? "3" : (currentMode === 'five' ? "5" : "10"));
                    let labels = currentMode === 'triple' ? ["–ü—Ä–æ—à–ª–æ–µ", "–ù–∞—Å—Ç–æ—è—â–µ–µ", "–ë—É–¥—É—â–µ–µ"] : 
                                (currentMode === 'five' ? ["–ü—Ä–æ—à–ª–æ–µ", "–ù–∞—Å—Ç–æ—è—â–µ–µ", "–ë—É–¥—É—â–µ–µ", "–°–∫—Ä—ã—Ç–æ–µ", "–ò—Ç–æ–≥"] : 
                                ["–¢–µ–∫—É—â–µ–µ", "–ü—Ä–æ–±–ª–µ–º–∞", "–ü—Ä–æ—à–ª–æ–µ", "–ë—É–¥—É—â–µ–µ", "–°–æ–∑–Ω–∞–Ω–∏–µ", "–ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ", "–°–æ–≤–µ—Ç", "–í–Ω–µ—à–Ω–µ–µ", "–°—Ç—Ä–∞—Ö–∏", "–ò—Ç–æ–≥"]);
                    dataToSend = {
                        type: type,
                        cards: selectedCards.map((c, i) => ({ name: c.name, id: c.id, position: labels[i] }))
                    };
                }
                tg.sendData(JSON.stringify(dataToSend));
                setTimeout(() => { tg.close(); }, 300);
            } catch (e) {
                alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: " + e.message);
                btn.innerText = "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞";
                btn.style.opacity = "1";
            }
        }
    </script>
</body>
</html>