<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tarot Mira</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0; padding: 0;
            background: radial-gradient(circle at center, #1a0b2e 0%, #000000 100%);
            color: #e0e0e0; font-family: 'Montserrat', sans-serif;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden; -webkit-tap-highlight-color: transparent;
        }
        /* --- –°—Ç–∏–ª–∏ —Ç–µ –∂–µ, —á—Ç–æ –∏ –±—ã–ª–∏, —Å–∫—Ä—ã–ª –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏, –æ–Ω–∏ –Ω–µ –º–µ–Ω—è–ª–∏—Å—å --- */
        #menu-screen {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; width: 100%; position: absolute; z-index: 10;
            background: #111; transition: opacity 0.5s;
        }
        .menu-title { font-family: 'Cinzel', serif; font-size: 24px; color: #ffd700; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 2px; text-align: center; }
        .menu-btn {
            background: linear-gradient(45deg, #1c1c24, #2a2a35); border: 1px solid #c5a059; color: #fff;
            padding: 15px 25px; margin: 8px; border-radius: 8px; font-family: 'Cinzel', serif; font-size: 14px;
            width: 85%; max-width: 320px; cursor: pointer; transition: transform 0.2s, background 0.3s; position: relative; 
        }
        .menu-btn:active { transform: scale(0.95); background: #c5a059; color: #000; }
        .menu-btn span { display: block; font-size: 11px; font-family: 'Montserrat', sans-serif; color: #aaa; margin-top: 4px; text-transform: none; }
        .badge {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            background: #ffd700; color: #000; padding: 3px 6px; border-radius: 4px;
            font-size: 9px; font-weight: bold; font-family: 'Montserrat', sans-serif;
        }
        .badge-free { background: #4CAF50; color: #fff; }
        .badge-sale { background: #ff4444; color: #fff; border: 1px solid #fff; }
        #gallery-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; flex-direction: column; align-items: center; }
        .gallery-header { width: 100%; padding: 15px; display: flex; justify-content: space-between; align-items: center; background: #111; border-bottom: 1px solid #c5a059; box-sizing: border-box; }
        #gallery-tabs { width: 100%; display: flex; overflow-x: auto; background: #1a1a1a; padding: 10px 0; scrollbar-width: none; }
        .tab-btn { background: none; border: none; color: #777; padding: 5px 15px; white-space: nowrap; font-family: 'Cinzel', serif; font-size: 12px; cursor: pointer; transition: 0.3s; }
        .tab-btn.active { color: #ffd700; border-bottom: 2px solid #ffd700; }
        #gallery-grid { flex: 1; width: 100%; overflow-y: auto; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; align-content: start; box-sizing: border-box; }
        .gallery-item { width: 100%; aspect-ratio: 2/3; border-radius: 6px; overflow: hidden; border: 1px solid #c5a059; background: #111; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.5); transition: transform 0.2s; }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: filter 0.3s; }
        .gallery-item.locked img { filter: grayscale(100%) brightness(25%); }
        .gallery-item.locked::after { content: "üîí"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 18px; opacity: 0.4; }
        #card-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 200; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
        #game-screen { display: none; flex-direction: column; align-items: center; width: 100%; height: 100%; padding-top: 5px; }
        h2 { font-family: 'Cinzel', serif; margin-bottom: 5px; font-weight: 400; color: #ffd700; text-transform: uppercase; letter-spacing: 2px; text-align: center; font-size: 16px; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); height: 25px; }
        .cards-container { display: flex; justify-content: center; align-items: center; width: 100%; height: 500px; transition: all 0.3s; }
        .cards-container.mode-five, .cards-container.mode-ten { flex-wrap: wrap; align-content: center; }
        .card-wrapper { display: flex; flex-direction: column; align-items: center; margin: 0 4px; perspective: 1000px; }
        .card { position: relative; transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); border-radius: 8px; }
        .mode-single .card { width: 240px; height: 360px; }
        .mode-triple .card { width: 100px; height: 155px; }
        .mode-five .card { width: 85px; height: 130px; }
        .mode-ten .card-wrapper { width: 31%; margin: 2px 1%; }
        .mode-ten .card { width: 100%; height: 110px; border-radius: 5px; }
        .mode-ten .card-label { font-size: 8px; margin-top: 2px; height: 10px; max-width: 100%; }
        @media (max-width: 340px) { .mode-triple .card { width: 85px; height: 130px; } .mode-five .card { width: 70px; height: 110px; } .mode-ten .card { height: 90px; } }
        .card.is-flipped { transform: rotateY(180deg); }
        .card__face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 8px; overflow: hidden; border: 2px solid #c5a059; box-sizing: border-box; background: #000; }
        .mode-ten .card__face { border-radius: 5px; border-width: 1px; }
        .card__face--front { transform: rotateY(0deg); }
        .card__face--back { transform: rotateY(180deg); }
        .card-img-content { width: 100%; height: 100%; object-fit: cover; }
        .card-label { margin-top: 8px; text-align: center; font-size: 10px; color: #aaa; text-transform: uppercase; font-family: 'Montserrat', sans-serif; letter-spacing: 1px; height: 12px; }
        .info-block { margin-top: 5px; text-align: center; opacity: 0; transition: opacity 0.5s; height: 40px; }
        .info-block.visible { opacity: 1; }
        .card-name-text { font-family: 'Cinzel', serif; color: #ffd700; font-size: 16px; margin-bottom: 2px; }
        .card-desc-text { font-size: 11px; color: #ccc; max-width: 300px; margin: 0 auto; line-height: 1.2; }
        .action-btn { margin-top: auto; margin-bottom: 20px; padding: 12px 40px; background: linear-gradient(45deg, #c5a059, #ffd700); color: #000; border: none; border-radius: 4px; font-family: 'Cinzel', serif; font-weight: 700; font-size: 13px; opacity: 0; pointer-events: none; transition: opacity 0.5s; text-transform: uppercase; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); cursor: pointer; }
        .action-btn.visible { opacity: 1; pointer-events: all; }
    </style>
</head>
<body>

    <div id="menu-screen">
        <div class="menu-title" id="menu-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–∫–ª–∞–¥</div>
        
        <button class="menu-btn" onclick="startGame('single')">
            <b id="btn-single-t">–ö–∞—Ä—Ç–∞ –î–Ω—è</b>
            <span id="btn-single-d">–û–¥–∏–Ω —Å–æ–≤–µ—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</span>
            <div class="badge badge-free">FREE</div>
        </button>
        
        <button class="menu-btn" onclick="startGame('triple')">
            <b id="btn-triple-t">–¢—Ä–∏ –°—É–¥—å–±—ã</b>
            <span id="btn-triple-d">–ü—Ä–æ—à–ª–æ–µ / –ù–∞—Å—Ç–æ—è—â–µ–µ / –ë—É–¥—É—â–µ–µ</span>
            <div class="badge">PRO</div>
        </button>
        
        <button class="menu-btn" onclick="startGame('five')">
            <b id="btn-five-t">–ü–æ–¥–∫–æ–≤–∞</b>
            <span id="btn-five-d">–°–∫—Ä—ã—Ç–æ–µ –∏ –ò—Ç–æ–≥–∏</span>
            <div class="badge">PRO</div>
        </button>
        
        <button class="menu-btn" onclick="startGame('ten')" style="border-color: #ff4444; box-shadow: 0 0 10px rgba(255,68,68,0.2);">
            <b id="btn-ten-t">–ö–µ–ª—å—Ç—Å–∫–∏–π –ö—Ä–µ—Å—Ç</b>
            <span id="btn-ten-d">–ü–æ–ª–Ω—ã–π —Ä–∞—Å–∫–ª–∞–¥ (10 –∫–∞—Ä—Ç)</span>
            <div class="badge badge-sale" id="badge-sale">99‚ÇΩ PRO</div>
        </button>

        <button class="menu-btn" onclick="openGallery()" style="margin-top: 20px; background: #222; border-color: #777;">
            <b id="btn-coll-t">–ö–æ–ª–ª–µ–∫—Ü–∏—è –ö–∞—Ä—Ç</b>
            <span id="btn-coll-d">–í–∞—à–∞ —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è –¢–∞—Ä–æ</span>
        </button>
    </div>

    <div id="gallery-screen">
        <div class="gallery-header">
            <span style="font-family:'Cinzel', serif; color:#ffd700;" id="gal-header">–ö–æ–ª–ª–µ–∫—Ü–∏—è</span>
            <button onclick="closeGallery()" style="background:none; border:none; color:#ffd700; font-size:24px; cursor:pointer;">‚úï</button>
        </div>
        <div id="gallery-tabs">
            <button class="tab-btn active" onclick="filterGallery('major', event)" id="tab-major">–°—Ç–∞—Ä—à–∏–µ</button>
            <button class="tab-btn" onclick="filterGallery('wands', event)" id="tab-wands">–ñ–µ–∑–ª—ã</button>
            <button class="tab-btn" onclick="filterGallery('cups', event)" id="tab-cups">–ö—É–±–∫–∏</button>
            <button class="tab-btn" onclick="filterGallery('swords', event)" id="tab-swords">–ú–µ—á–∏</button>
            <button class="tab-btn" onclick="filterGallery('pentacles', event)" id="tab-pent">–ú–æ–Ω–µ—Ç—ã</button>
        </div>
        <div id="gallery-grid"></div>
    </div>

    <div id="card-modal" onclick="this.style.display='none'">
        <img id="modal-img" src="" style="width:80%; max-width:280px; border-radius:10px; border:2px solid #ffd700; margin-bottom:20px;">
        <h3 id="modal-title" style="color:#ffd700; font-family:'Cinzel', serif; margin:0; text-transform:uppercase;"></h3>
        <p id="modal-desc" style="text-align:center; color:#ccc; font-size:14px; max-width:300px; line-height:1.4; margin-top:10px;"></p>
        <span style="color:#777; font-size:10px; margin-top:20px;" id="modal-close">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å</span>
    </div>

    <div id="game-screen">
        <h2 id="status-text">–ö–æ—Å–Ω–∏—Ç–µ—Å—å –∫–∞—Ä—Ç—ã</h2>
        <div class="cards-container" id="cards-container"></div>
        <div class="info-block" id="info-block">
            <div class="card-name-text" id="info-name"></div>
            <div class="card-desc-text" id="info-desc"></div>
        </div>
        <button class="action-btn" id="sendBtn" onclick="sendResult()">–ü—Ä–∏–Ω—è—Ç—å –°—É–¥—å–±—É</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // üåç –ü–ï–†–ï–í–û–î–´ –ò–ù–¢–ï–†–§–ï–ô–°–ê
        const UI_TEXTS = {
            ru: {
                menu: "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–∫–ª–∞–¥",
                s_t: "–ö–∞—Ä—Ç–∞ –î–Ω—è", s_d: "–û–¥–∏–Ω —Å–æ–≤–µ—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è",
                t_t: "–¢—Ä–∏ –°—É–¥—å–±—ã", t_d: "–ü—Ä–æ—à–ª–æ–µ / –ù–∞—Å—Ç–æ—è—â–µ–µ / –ë—É–¥—É—â–µ–µ",
                f_t: "–ü–æ–¥–∫–æ–≤–∞", f_d: "–°–∫—Ä—ã—Ç–æ–µ –∏ –ò—Ç–æ–≥–∏",
                x_t: "–ö–µ–ª—å—Ç—Å–∫–∏–π –ö—Ä–µ—Å—Ç", x_d: "–ü–æ–ª–Ω—ã–π —Ä–∞—Å–∫–ª–∞–¥ (10 –∫–∞—Ä—Ç)",
                sale: "290‚ÇΩ | 99‚ÇΩ PRO",
                c_t: "–ö–æ–ª–ª–µ–∫—Ü–∏—è", c_d: "–í–∞—à–∞ —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è",
                gal: "–ö–æ–ª–ª–µ–∫—Ü–∏—è",
                tabs: ["–°—Ç–∞—Ä—à–∏–µ", "–ñ–µ–∑–ª—ã", "–ö—É–±–∫–∏", "–ú–µ—á–∏", "–ú–æ–Ω–µ—Ç—ã"],
                touch: "–ö–æ—Å–Ω–∏—Ç–µ—Å—å –∫–∞—Ä—Ç—ã", done: "–°—É–¥—å–±–∞ –æ—Ç–∫—Ä—ã—Ç–∞", send: "–ü—Ä–∏–Ω—è—Ç—å –°—É–¥—å–±—É",
                locked_t: "–ö–∞—Ä—Ç–∞ —Å–∫—Ä—ã—Ç–∞", locked_d: "–≠—Ç–∞ —ç–Ω–µ—Ä–≥–∏—è –µ—â–µ –Ω–µ –ø—Ä–æ—è–≤–ª–µ–Ω–∞. –î–µ–ª–∞–π —Ä–∞—Å–∫–ª–∞–¥—ã.", close: "–ó–∞–∫—Ä—ã—Ç—å",
                pos_3: ["–ü—Ä–æ—à–ª–æ–µ", "–ù–∞—Å—Ç–æ—è—â–µ–µ", "–ë—É–¥—É—â–µ–µ"],
                pos_5: ["–ü—Ä–æ—à–ª–æ–µ", "–ù–∞—Å—Ç–æ—è—â–µ–µ", "–ë—É–¥—É—â–µ–µ", "–°–∫—Ä—ã—Ç–æ–µ", "–ò—Ç–æ–≥"],
                pos_10: ["–°—É—Ç—å", "–ü—Ä–æ–±–ª–µ–º–∞", "–ü—Ä–æ—à–ª–æ–µ", "–ë—É–¥—É—â–µ–µ", "–°–æ–∑–Ω–∞–Ω–∏–µ", "–ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ", "–°–æ–≤–µ—Ç", "–í–Ω–µ—à–Ω–µ–µ", "–°—Ç—Ä–∞—Ö–∏", "–ò—Ç–æ–≥"]
            },
            pt: {
                menu: "Escolha a Leitura",
                s_t: "Carta do Dia", s_d: "Um conselho para hoje",
                t_t: "Tr√™s Destinos", t_d: "Passado / Presente / Futuro",
                f_t: "Ferradura", f_d: "Oculto e Resultados",
                x_t: "Cruz Celta", x_d: "Leitura Completa (10 cartas)",
                sale: "R$ 15 | PRO",
                c_t: "Cole√ß√£o", c_d: "Sua enciclop√©dia",
                gal: "Cole√ß√£o",
                tabs: ["Arcanos Maiores", "Paus", "Copas", "Espadas", "Ouros"],
                touch: "Toque na carta", done: "Destino revelado", send: "Aceitar Destino",
                locked_t: "Carta Bloqueada", locked_d: "Energia ainda n√£o revelada. Jogue mais.", close: "Fechar",
                pos_3: ["Passado", "Presente", "Futuro"],
                pos_5: ["Passado", "Presente", "Futuro", "Oculto", "Resultado"],
                pos_10: ["Ess√™ncia", "Problema", "Passado", "Futuro", "Consciente", "Inconsciente", "Conselho", "Externo", "Medos", "Resultado"]
            },
            es: {
                menu: "Elige Tirada",
                s_t: "Carta del D√≠a", s_d: "Consejo para hoy",
                t_t: "Tres Destinos", t_d: "Pasado / Presente / Futuro",
                f_t: "Herradura", f_d: "Oculto y Resultados",
                x_t: "Cruz Celta", x_d: "Lectura Completa (10 cartas)",
                sale: "$5 USD | PRO",
                c_t: "Colecci√≥n", c_d: "Tu enciclopedia",
                gal: "Colecci√≥n",
                tabs: ["Arcanos Mayores", "Bastos", "Copas", "Espadas", "Oros"],
                touch: "Toca la carta", done: "Destino revelado", send: "Aceptar Destino",
                locked_t: "Carta Bloqueada", locked_d: "Energ√≠a no revelada a√∫n. Juega m√°s.", close: "Cerrar",
                pos_3: ["Pasado", "Presente", "Futuro"],
                pos_5: ["Pasado", "Presente", "Futuro", "Oculto", "Resultado"],
                pos_10: ["Esencia", "Problema", "Pasado", "Futuro", "Consciente", "Inconsciente", "Consejo", "Externo", "Miedos", "Resultado"]
            }
        };

        // üåå –î–ê–ù–ù–´–ï –ö–ê–†–¢ (–ë–∞–∑–∞ - ID –∏ –¢–∏–ø)
        const baseDeck = [
            {id: "fool", type: "major"}, {id: "magician", type: "major"}, {id: "priestess", type: "major"},
            {id: "empress", type: "major"}, {id: "emperor", type: "major"}, {id: "hierophant", type: "major"},
            {id: "lovers", type: "major"}, {id: "chariot", type: "major"}, {id: "strength", type: "major"},
            {id: "hermit", type: "major"}, {id: "fortune", type: "major"}, {id: "justice", type: "major"},
            {id: "hanged", type: "major"}, {id: "death", type: "major"}, {id: "temperance", type: "major"},
            {id: "devil", type: "major"}, {id: "tower", type: "major"}, {id: "star", type: "major"},
            {id: "moon", type: "major"}, {id: "sun", type: "major"}, {id: "judgement", type: "major"}, {id: "world", type: "major"},
            // Minor Arcana (simplified generation)
        ];
        // –î–æ–±–∞–≤–ª—è–µ–º –º–ª–∞–¥—à–∏–µ –∞—Ä–∫–∞–Ω—ã –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
        const suits = ["wands", "cups", "swords", "pentacles"];
        const ranks = ["ace", "2", "3", "4", "5", "6", "7", "8", "9", "10", "page", "knight", "queen", "king"];
        suits.forEach(s => ranks.forEach(r => baseDeck.push({id: `${s}_${r}`, type: s})));

        // üåå –ü–ï–†–ï–í–û–î–´ –ö–ê–†–¢ (RU, PT, ES)
        const CARD_TEXTS = {
            ru: {
                fool: ["–®—É—Ç", "–ù–∞—á–∞–ª–æ, —Å–≤–æ–±–æ–¥–∞, —Ä–∏—Å–∫."], magician: ["–ú–∞–≥", "–í–æ–ª—è, –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ."], priestess: ["–ñ—Ä–∏—Ü–∞", "–ò–Ω—Ç—É–∏—Ü–∏—è, —Ç–∞–π–Ω–∞."],
                empress: ["–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", "–ü–ª–æ–¥–æ—Ä–æ–¥–∏–µ, –ø—Ä–∏—Ä–æ–¥–∞."], emperor: ["–ò–º–ø–µ—Ä–∞—Ç–æ—Ä", "–í–ª–∞—Å—Ç—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞."], hierophant: ["–ò–µ—Ä–æ—Ñ–∞–Ω—Ç", "–¢—Ä–∞–¥–∏—Ü–∏—è, –≤–µ—Ä–∞."],
                lovers: ["–í–ª—é–±–ª–µ–Ω–Ω—ã–µ", "–í—ã–±–æ—Ä, —Å–æ—é–∑."], chariot: ["–ö–æ–ª–µ—Å–Ω–∏—Ü–∞", "–ü–æ–±–µ–¥–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å."], strength: ["–°–∏–ª–∞", "–¢–µ—Ä–ø–µ–Ω–∏–µ, –º—è–≥–∫–∞—è —Å–∏–ª–∞."],
                hermit: ["–û—Ç—à–µ–ª—å–Ω–∏–∫", "–ú—É–¥—Ä–æ—Å—Ç—å, —É–µ–¥–∏–Ω–µ–Ω–∏–µ."], fortune: ["–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", "–£–¥–∞—á–∞, –ø–µ—Ä–µ–º–µ–Ω—ã."], justice: ["–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", "–ü—Ä–∞–≤–¥–∞, –∑–∞–∫–æ–Ω."],
                hanged: ["–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", "–ñ–µ—Ä—Ç–≤–∞, –ø–∞—É–∑–∞."], death: ["–°–º–µ—Ä—Ç—å", "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è."], temperance: ["–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", "–ë–∞–ª–∞–Ω—Å, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ."],
                devil: ["–î—å—è–≤–æ–ª", "–ò—Å–∫—É—à–µ–Ω–∏–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å."], tower: ["–ë–∞—à–Ω—è", "–ö—Ä–∞—Ö, –æ—á–∏—â–µ–Ω–∏–µ."], star: ["–ó–≤–µ–∑–¥–∞", "–ù–∞–¥–µ–∂–¥–∞, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ."],
                moon: ["–õ—É–Ω–∞", "–ò–ª–ª—é–∑–∏–∏, —Å–Ω—ã."], sun: ["–°–æ–ª–Ω—Ü–µ", "–£—Å–ø–µ—Ö, —Ä–∞–¥–æ—Å—Ç—å."], judgement: ["–°—É–¥", "–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ."], world: ["–ú–∏—Ä", "–ì–∞—Ä–º–æ–Ω–∏—è, —Ñ–∏–Ω–∞–ª."],
                // Generic for minors (RU)
                wands: "–ñ–µ–∑–ª–æ–≤", cups: "–ö—É–±–∫–æ–≤", swords: "–ú–µ—á–µ–π", pentacles: "–ú–æ–Ω–µ—Ç",
                ace: "–¢—É–∑", page: "–ü–∞–∂", knight: "–†—ã—Ü–∞—Ä—å", queen: "–ö–æ—Ä–æ–ª–µ–≤–∞", king: "–ö–æ—Ä–æ–ª—å"
            },
            pt: {
                fool: ["O Louco", "In√≠cio, liberdade, risco."], magician: ["O Mago", "Vontade, maestria."], priestess: ["A Sacerdotisa", "Intui√ß√£o, mist√©rio."],
                empress: ["A Imperatriz", "Fertilidade, natureza."], emperor: ["O Imperador", "Poder, estrutura."], hierophant: ["O Hierofante", "Tradi√ß√£o, f√©."],
                lovers: ["Os Enamorados", "Escolha, uni√£o."], chariot: ["O Carro", "Vit√≥ria, controle."], strength: ["A For√ßa", "Paci√™ncia, for√ßa suave."],
                hermit: ["O Eremita", "Sabedoria, solid√£o."], fortune: ["Roda da Fortuna", "Sorte, mudan√ßa."], justice: ["A Justi√ßa", "Verdade, lei."],
                hanged: ["O Enforcado", "Sacrif√≠cio, pausa."], death: ["A Morte", "Transforma√ß√£o."], temperance: ["A Temperan√ßa", "Equil√≠brio, cura."],
                devil: ["O Diabo", "Tenta√ß√£o, v√≠cio."], tower: ["A Torre", "Colapso, purifica√ß√£o."], star: ["A Estrela", "Esperan√ßa, inspira√ß√£o."],
                moon: ["A Lua", "Ilus√£o, sonhos."], sun: ["O Sol", "Sucesso, alegria."], judgement: ["O Julgamento", "Renascimento."], world: ["O Mundo", "Harmonia, final."],
                // Generic PT
                wands: "de Paus", cups: "de Copas", swords: "de Espadas", pentacles: "de Ouros",
                ace: "√Ås", page: "Valete", knight: "Cavaleiro", queen: "Rainha", king: "Rei"
            },
            es: {
                fool: ["El Loco", "Inicio, libertad."], magician: ["El Mago", "Voluntad, maestr√≠a."], priestess: ["La Sacerdotisa", "Intuici√≥n, misterio."],
                empress: ["La Emperatriz", "Fertilidad, naturaleza."], emperor: ["El Emperador", "Poder, estructura."], hierophant: ["El Hierofante", "Tradici√≥n, fe."],
                lovers: ["Los Enamorados", "Elecci√≥n, uni√≥n."], chariot: ["El Carro", "Victoria, control."], strength: ["La Fuerza", "Paciencia, fuerza."],
                hermit: ["El Ermita√±o", "Sabidur√≠a, soledad."], fortune: ["Rueda de Fortuna", "Suerte, cambio."], justice: ["La Justicia", "Verdad, ley."],
                hanged: ["El Colgado", "Sacrificio, pausa."], death: ["La Muerte", "Transformaci√≥n."], temperance: ["La Templanza", "Equilibrio, curaci√≥n."],
                devil: ["El Diablo", "Tentaci√≥n, adicci√≥n."], tower: ["La Torre", "Colapso, purificaci√≥n."], star: ["La Estrella", "Esperanza, inspiraci√≥n."],
                moon: ["La Luna", "Ilusi√≥n, sue√±os."], sun: ["El Sol", "√âxito, alegr√≠a."], judgement: ["El Juicio", "Renacimiento."], world: ["El Mundo", "Armon√≠a, final."],
                // Generic ES
                wands: "de Bastos", cups: "de Copas", swords: "de Espadas", pentacles: "de Oros",
                ace: "As", page: "Sota", knight: "Caballo", queen: "Reina", king: "Rey"
            }
        };

        // --- –õ–û–ì–ò–ö–ê ---
        let lang = new URLSearchParams(window.location.search).get('lang') || 'ru';
        let T = UI_TEXTS[lang] || UI_TEXTS['ru'];
        let C = CARD_TEXTS[lang] || CARD_TEXTS['ru'];
        
        let tarotDeck = [];

        // –°–±–æ—Ä–∫–∞ –∫–æ–ª–æ–¥—ã —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º
        baseDeck.forEach(c => {
            let name, desc;
            if (c.type === 'major') {
                [name, desc] = C[c.id] || [c.id, ""];
            } else {
                // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è –º–ª–∞–¥—à–∏—Ö (–¢—É–∑ –ö—É–±–∫–æ–≤ / √Ås de Copas)
                let [suit, rank] = c.id.split('_');
                let rankName = C[rank] || rank;
                let suitName = C[suit] || suit;
                name = `${rankName} ${suitName}`; // –í PT/ES –ø—Ä–µ–¥–ª–æ–≥–∏ —É–∂–µ –≤–Ω—É—Ç—Ä–∏ suitName
                desc = T.locked_d; // –ó–∞–≥–ª—É—à–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –º–ª–∞–¥—à–∏—Ö, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å —Ñ–∞–π–ª
            }
            tarotDeck.push({ ...c, name: name, desc: desc });
        });

        // –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –¢–ï–ö–°–¢–û–í UI
        document.getElementById('menu-title').innerText = T.menu;
        document.getElementById('btn-single-t').innerText = T.s_t; document.getElementById('btn-single-d').innerText = T.s_d;
        document.getElementById('btn-triple-t').innerText = T.t_t; document.getElementById('btn-triple-d').innerText = T.t_d;
        document.getElementById('btn-five-t').innerText = T.f_t; document.getElementById('btn-five-d').innerText = T.f_d;
        document.getElementById('btn-ten-t').innerText = T.x_t; document.getElementById('btn-ten-d').innerText = T.x_d;
        document.getElementById('badge-sale').innerText = T.sale;
        document.getElementById('btn-coll-t').innerText = T.c_t; document.getElementById('btn-coll-d').innerText = T.c_d;
        document.getElementById('gal-header').innerText = T.gal;
        document.getElementById('status-text').innerText = T.touch;
        document.getElementById('sendBtn').innerText = T.send;
        document.getElementById('modal-close').innerText = T.close;
        
        // –¢–∞–±—ã
        ['major', 'wands', 'cups', 'swords', 'pent'].forEach((id, i) => {
            document.getElementById(`tab-${id}`).innerText = T.tabs[i];
        });

        // --- –î–ê–õ–ï–ï –°–¢–ê–ù–î–ê–†–¢–ù–ê–Ø –õ–û–ì–ò–ö–ê ---
        
        function unlockCard(cardId) {
            let collection = JSON.parse(localStorage.getItem('mira_collection') || '[]');
            if (!collection.includes(cardId)) {
                collection.push(cardId);
                localStorage.setItem('mira_collection', JSON.stringify(collection));
            }
        }

        function isCardUnlocked(cardId) {
            let collection = JSON.parse(localStorage.getItem('mira_collection') || '[]');
            return collection.includes(cardId);
        }

        function openGallery() {
            document.getElementById('gallery-screen').style.display = 'flex';
            filterGallery('major'); 
        }

        function closeGallery() { document.getElementById('gallery-screen').style.display = 'none'; }

        function filterGallery(type, event) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            if (event) { event.target.classList.add('active'); } 
            else { 
                let sel = type === 'pentacles' ? 'pent' : type; // fix id mismatch
                let el = document.getElementById(`tab-${sel}`);
                if(el) el.classList.add('active');
            }

            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = '';

            const filtered = tarotDeck.filter(c => c.type === type);
            filtered.forEach(card => {
                const unlocked = isCardUnlocked(card.id);
                const item = document.createElement('div');
                item.className = 'gallery-item' + (unlocked ? '' : ' locked');
                item.onclick = () => showCardDetail(card, unlocked);
                item.innerHTML = `<img src="cards/${card.id}.jpg">`;
                grid.appendChild(item);
            });
        }

        function showCardDetail(card, unlocked) {
            const modalImg = document.getElementById('modal-img');
            modalImg.src = `cards/${card.id}.jpg`;
            modalImg.style.filter = unlocked ? 'none' : 'grayscale(100%) brightness(25%)';
            
            document.getElementById('modal-title').innerText = unlocked ? card.name : T.locked_t;
            document.getElementById('modal-desc').innerText = unlocked ? card.desc : T.locked_d;
            document.getElementById('card-modal').style.display = 'flex';
        }

        let currentMode = 'single';
        let selectedCards = [];
        let flippedCount = 0;

        function startGame(mode) {
            currentMode = mode;
            document.getElementById('menu-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('menu-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'flex';
                initBoard();
            }, 500);
        }

        function initBoard() {
            const container = document.getElementById('cards-container');
            container.innerHTML = '';
            flippedCount = 0;
            selectedCards = [];
            const shuffled = [...tarotDeck].sort(() => 0.5 - Math.random());
            
            container.className = 'cards-container';
            container.classList.add(`mode-${currentMode}`);

            let count = (currentMode === 'single' ? 1 : (currentMode === 'triple' ? 3 : (currentMode === 'five' ? 5 : 10)));
            
            // Labels from translations
            let labels = [];
            if (currentMode === 'triple') labels = T.pos_3;
            else if (currentMode === 'five') labels = T.pos_5;
            else if (currentMode === 'ten') labels = T.pos_10;

            for (let i = 0; i < count; i++) {
                const cardData = shuffled[i];
                selectedCards.push(cardData);
                const wrapper = document.createElement('div');
                wrapper.className = 'card-wrapper';
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.onclick = () => flipCardLogic(cardEl, cardData, i);
                cardEl.innerHTML = `
                    <div class="card__face card__face--front"><img src="cards/back.jpg" class="card-img-content"></div>
                    <div class="card__face card__face--back"><img src="cards/${cardData.id}.jpg" class="card-img-content"></div>
                `;
                wrapper.appendChild(cardEl);
                if (currentMode !== 'single') {
                    const labelEl = document.createElement('div');
                    labelEl.className = 'card-label';
                    labelEl.innerText = labels[i];
                    wrapper.appendChild(labelEl);
                }
                container.appendChild(wrapper);
            }
        }

        function flipCardLogic(element, data, index) {
            if (element.classList.contains('is-flipped')) return;
            element.classList.add('is-flipped');
            flippedCount++;
            
            unlockCard(data.id);

            if (currentMode === 'single') {
                document.getElementById('status-text').innerText = T.done;
                document.getElementById('info-name').innerText = data.name;
                document.getElementById('info-desc').innerText = data.desc;
                document.getElementById('info-block').classList.add('visible');
            } else {
                const total = selectedCards.length;
                if (flippedCount === total) document.getElementById('status-text').innerText = T.done;
            }
            if (flippedCount === selectedCards.length) {
                setTimeout(() => { document.getElementById('sendBtn').classList.add('visible'); }, 600);
            }
        }

        function sendResult() {
            const btn = document.getElementById('sendBtn');
            btn.style.opacity = "0.7";
            let dataToSend = {};
            try {
                if (currentMode === 'single') {
                    dataToSend = { type: "tarot_result", card_name: selectedCards[0].name, card_id: selectedCards[0].id };
                } else {
                    let type = "tarot_spread_" + (currentMode === 'triple' ? "3" : (currentMode === 'five' ? "5" : "10"));
                    // Labels again for sending
                    let labels = [];
                    if (currentMode === 'triple') labels = T.pos_3;
                    else if (currentMode === 'five') labels = T.pos_5;
                    else if (currentMode === 'ten') labels = T.pos_10;

                    dataToSend = {
                        type: type,
                        cards: selectedCards.map((c, i) => ({ name: c.name, id: c.id, position: labels[i] }))
                    };
                }
                tg.sendData(JSON.stringify(dataToSend));
                setTimeout(() => { tg.close(); }, 300);
            } catch (e) {
                alert("Error: " + e.message);
                btn.style.opacity = "1";
            }
        }
    </script>
</body>
</html>