<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tarot Mira</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: radial-gradient(circle at center, #1a0b2e 0%, #000000 100%);
            color: #e0e0e0;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        h2 { 
            font-family: 'Cinzel', serif;
            margin-bottom: 20px;
            font-weight: 400; 
            color: #ffd700;
            text-transform: uppercase; 
            letter-spacing: 3px; 
            text-align: center; 
            font-size: 14px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            position: absolute;
            top: 30px;
            width: 100%;
        }

        .scene {
            perspective: 1000px;
            width: 260px; 
            height: 390px;
            position: relative;
            margin-top: 40px;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border-radius: 12px;
        }

        .card.is-flipped {
            transform: rotateY(180deg);
        }

        .card__face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #c5a059; /* Тонкая золотая рамка */
            box-sizing: border-box;
        }

        .card-img-content {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .card__face--front { background: #000; }
        .card__face--back { background: #000; transform: rotateY(180deg); }
        
        .card-info {
            margin-top: 25px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }
        .card-info.visible { opacity: 1; }

        .card-name { 
            font-family: 'Cinzel', serif;
            font-weight: 700; 
            font-size: 20px; 
            color: #ffd700;
            text-transform: uppercase; 
            margin-bottom: 8px; 
            letter-spacing: 1px;
        }
        .card-desc { 
            font-family: 'Montserrat', sans-serif;
            font-size: 12px; 
            color: #aaa; 
            max-width: 260px;
        }

        .btn {
            margin-top: 30px;
            padding: 16px 40px;
            background: linear-gradient(45deg, #c5a059, #ffd700);
            color: #000;
            border: none;
            border-radius: 2px;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 14px;
            letter-spacing: 1px;
            opacity: 0;
            transition: opacity 0.5s, transform 0.2s;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            text-transform: uppercase;
        }
        .btn.visible { opacity: 1; }
        .btn:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <h2 id="status">Коснитесь карты</h2>

    <div class="scene">
        <div class="card" onclick="flipCard()">
            <div class="card__face card__face--front">
                <img src="cards/back.jpg" class="card-img-content" alt="Back">
            </div>
            <div class="card__face card__face--back">
                <img id="chosen-card-img" src="" class="card-img-content" alt="Tarot Card">
            </div>
        </div>
    </div>

    <div class="card-info" id="cardInfoBlock">
        <div class="card-name" id="c_name"></div>
        <div class="card-desc" id="c_desc"></div>
    </div>

    <button class="btn" id="sendBtn" onclick="sendResult()">Принять Судьбу</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); 

        // Полный список карт (JPG)
        const tarotDeck = [
            {name: "Шут", id: "fool", desc: "Начало, свобода, риск"},
            {name: "Маг", id: "magician", desc: "Воля, мастерство, действие"},
            {name: "Жрица", id: "priestess", desc: "Интуиция, тайны, мудрость"},
            {name: "Императрица", id: "empress", desc: "Плодородие, творчество, природа"},
            {name: "Император", id: "emperor", desc: "Власть, структура, защита"},
            {name: "Иерофант", id: "hierophant", desc: "Традиция, духовный учитель, вера"},
            {name: "Влюбленные", id: "lovers", desc: "Любовь, выбор, гармония"},
            {name: "Колесница", id: "chariot", desc: "Победа, движение, контроль"},
            {name: "Сила", id: "strength", desc: "Сила духа, терпение, смелость"},
            {name: "Отшельник", id: "hermit", desc: "Поиск истины, уединение"},
            {name: "Колесо Фортуны", id: "fortune", desc: "Судьба, удача, перемены"},
            {name: "Справедливость", id: "justice", desc: "Правда, закон, ответственность"},
            {name: "Повешенный", id: "hanged", desc: "Жертва, новый взгляд, пауза"},
            {name: "Смерть", id: "death", desc: "Трансформация, конец старого"},
            {name: "Умеренность", id: "temperance", desc: "Баланс, гармония, исцеление"},
            {name: "Дьявол", id: "devil", desc: "Искушение, зависимость, тень"},
            {name: "Башня", id: "tower", desc: "Разрушение, внезапные перемены"},
            {name: "Звезда", id: "star", desc: "Надежда, вдохновение, вера"},
            {name: "Луна", id: "moon", desc: "Иллюзии, интуиция, сны"},
            {name: "Солнце", id: "sun", desc: "Радость, успех, ясность"},
            {name: "Суд", id: "judgement", desc: "Возрождение, призыв, прощение"},
            {name: "Мир", id: "world", desc: "Завершение, целостность, триумф"}
        ];

        let hasFlipped = false;
        let chosenCard = null;

        function flipCard() {
            if (hasFlipped) return;
            
            chosenCard = tarotDeck[Math.floor(Math.random() * tarotDeck.length)];
            
            // Ищем картинку JPG
            const imgPath = `cards/${chosenCard.id}.jpg`;
            
            // Предзагрузка, чтобы не моргало
            const imgObj = new Image();
            imgObj.src = imgPath;
            imgObj.onload = () => {
                document.getElementById('chosen-card-img').src = imgPath;
                
                document.getElementById('c_name').innerText = chosenCard.name;
                document.getElementById('c_desc').innerText = chosenCard.desc;

                const card = document.querySelector('.card');
                card.classList.add('is-flipped');
                
                document.getElementById('status').innerText = "Судьба открыта";
                
                setTimeout(() => {
                     document.getElementById('cardInfoBlock').classList.add('visible');
                    document.getElementById('sendBtn').classList.add('visible');
                }, 800);
            };
            
            hasFlipped = true;
        }

        function sendResult() {
            if (!chosenCard) return;
            const data = JSON.stringify({
                type: "tarot_result",
                card_name: chosenCard.name,
                card_id: chosenCard.id
            });
            tg.sendData(data);
        }
    </script>
</body>
</html>